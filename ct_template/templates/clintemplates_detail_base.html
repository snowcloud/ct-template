{% extends "base.html" %}
{% load i18n markup tagging_tags ct_tags ct_groups_tags eltree sitevars utils %}

{% block title %}{{ clin_template.name }}{% endblock %}
{% block head_extra %}
<link rel="stylesheet" href="/static/css/ct_template.css" type="text/css" media="screen, projection">
{# <script type='text/javascript' src='/media/js/jquery-1.4.2.min.js'></script> #}
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
<script src="/static/js/ct_collapsible.js"></script>

<script type="text/javascript">

function togglecomments(el) {
	// var divname = 'h_' + el;
	//alert(el)
	var div = $("#h_" + el)
	var a = $("#l_" + el)
	if (div.css('display')=='none') {
		a.text('{% trans 'Hide comments' %}')
	} else {
		a.text('{% trans 'Show comments' %}')
	}
	div.slideToggle(300);
}

$(document).ready(function() {
    $("head").append("<link>");
    css = $("head").children(":last");
    css.attr({
      rel:  "stylesheet",
      type: "text/css",
      href: "/static/css/ct_template_enhanced.css"
    });
    
    $("#ct-tabs").show();
	$("#ct-tabs").tabs({
		cache: true,
        {% if not clin_template.inf_model %}disabled: [0, 1],{% endif %}
        {% if tView %}selected: {{ tView }},{% endif %}
		load: function(event, ui) {
			{# load is called on load of each tab- setup stuff just for that tab, or it's added multiple times #}
			{% if comment_id  %}togglecomments('{{comment_id}}');location.href='#{{comment_id}}';{% endif %}
			var view = '#ct_view' + $("#ct-tabs").tabs('option', 'selected');
            if (view=="#ct_view2") { $('#ct_view2 h3').collapsible(); };
			$(view + ' .toggleallcomments').click(function(event){
				var show = $(this).text().indexOf("{% trans "Show all comments" %}") > -1;
				if (show) { $(this).text("{% trans 'Hide all comments' %}"); }
				else { $(this).text("{% trans 'Show all comments' %}"); }
				{# alert(view + " " + show); #}
				if (show) {
					$(view + " .ct_comments_hide_show").show(300);
					t = '{% trans 'Hide comments' %}'	;
				} else {
					$(view + " .ct_comments_hide_show").hide(300);
					t = '{% trans 'Show comments' %}';
				}
				$(view + " .toggle_comment").text(t);
				return false;
		   });
		   $(view + ' .togglealldocs').click(function(event){
				var show = $(this).text().indexOf("{% trans "Show all text" %}") > -1;
				if (show) { $(this).text("{% trans 'Hide all text' %}"); }
				else { $(this).text("{% trans 'Show all text' %}"); }
                if (show) {
                    $(view + " .collapsible-content").removeClass("collapsible-content-collapsed");
                    $(view + " .collapsible-heading").removeClass("collapsible-heading-collapsed");
                } else {
                    $(view + " .collapsible-content").addClass("collapsible-content-collapsed");
                    $(view + " .collapsible-heading").addClass("collapsible-heading-collapsed");
                }
				return false;
		   });
		
		} 
	});
	$("#ct-tabs-alt").hide();
});

</script>
{% endblock %}

{% block breadcrumbs %}
  <a href="{% site_base %}">{% trans 'Home' %}</a>	&gt;
  <a href="{% site_base %}groups">{% trans 'Groups' %}</a>	&gt;
  <a href="{% url group clin_template.workgroup.slug %}">{{ clin_template.workgroup.name }}</a>
{% endblock %}

{% block content %}

{% if clin_template.workgroup %}
<p>{% trans 'in' %} <a href="{% url group clin_template.workgroup.slug %}">{{ clin_template.workgroup.name }}</a></p>
{% endif %}


<h1>{{ clin_template.name }}</h1>

  {{ clin_template.note|default_if_none:""|textile }}
  {% tags_for_object clin_template as tag_list %}


  {% if tag_list %}
	  <p>{% trans 'Topics' %}:
		  {% for tag in tag_list %}
			  <a href="{% url tag tag.name %}">{% trans tag.name %}</a>{% if not forloop.last %},{% endif %}
		  {% endfor %}</p>
  {% endif %}


{% comment %}
{% if user.is_staff %}
  <p><a href="{% site_base %}admin/ct_template/clintemplate/{{ clin_template.id }}/">edit</a></p>
{% endif %}
{% endcomment %}  

{# <div id="ct_metadata"> #}
{#	   <table width="90%"> #}
{#		   {% for item in clin_template.metadata.items %} #}
{#			   <tr><th width="20%">{% trans item.0 %}:</th><td width="60%">{{ item.1|default_if_none:""|textile }}</td></tr> #}
{#		   {% endfor %} #}
{#		   {% if clin_template.included_templates.all %} #}
{#			   <tr><th width="20%">{% trans 'Includes' %}:</th> #}
{#				   <td width="60%"> #}
{#				   {% for t in clin_template.included_templates.all %} #}
{#					   <a href="{% site_base %}templates/{{ t.id }}/">{{ t.name }}</a>{% if not forloop.last %},{% endif %} #}
{#				   {% endfor %} #}
{#			   </td></tr> #}
{#		   {% endif %} #}
{#		   {% if clin_template.in_templates.all %} #}
{#			   <tr><th width="20%">{% trans 'Used in' %}:</th> #}
{#				   <td width="60%"> #}
{#				   {% for t in clin_template.in_templates.all %} #}
{#					   <a href="{% site_base %}templates/{{ t.id }}/">{{ t.name }}</a>{% if not forloop.last %},{% endif %} #}
{#				   {% endfor %} #}
{#			   </td></tr> #}
{#		   {% endif %} #}
{#		   {% tags_for_object clin_template as tag_list %} #}
{#		   {% if tag_list %} #}
{#			   <tr><th width="20%">{% trans 'Topics' %}:</th> #}
{#				   <td width="60%"> #}
{#				   {% for tag in tag_list %} #}
{#					   <a href="{% url tag tag.name %}">{% trans tag.name %}</a>{% if not forloop.last %},{% endif %} #}
{#				   {% endfor %} #}
{#			   </td></tr> #}
{#		   {% endif %} #}
{#	#}
{#	#}
{#	   </table> #}
{# </div> #}

<br/>

{% if clin_template.accept_reviews %}
	
	<h2>Reviews</h2>

	<p>You can use a review to give an overall view of a template, rather than contribute comments intended to help develop a it.</p> 

	<p>Comments are not available on templates based on standardised tools, so leave a review if you want to recommend a template, or advise others on weaknesses in the evidence or problems in using it.</p>

	{% if clin_template.clintemplatereview_set.all %}
	<p class="small">ratings: 1 = serious concern, 2 = some concern, 3 = acceptable for use, 4 = useful, 5 = recommended</p>

	<div class="siteresources">
		<table width="100%">
			{% for review in clin_template.clintemplatereview_set.all %}
				<tr><th width="20%">{{ review.reviewer.get_full_name }}:<br/>
				<span class="small">{{ review.review_date|date:"j F Y, H:i" }}</span><br/>
				<span class="small">{{ review.rating|rating_display }}</span>
				</th>
				<td width="60%">{{ review.review|linebreaksbr }}</td></tr>
			{% endfor %}
		</table>
	</div>
	{% endif %}

	{% comment %}
		if not authorised
			log in to add a review
		else
			check perm can comment
		
			if user.is_authenticated %}
				{% if clin_template.workgroup|can_comment:user
				
	{% endcomment %}

	<p>
	{% if user.is_authenticated %}
		{% if clin_template.workgroup|can_comment:user %}
		   <a href="/templates/{{ clin_template.id }}/addreview/">Add a review of this template.</a>
		{% else %}
			Sorry, you don't have access to add a review.
		{% endif %}
	{% else %}
		<a href="{% site_base %}accounts/login/?next={{ REQ_FULL_PATH|nologout }}">log in</a> to add a review.
	{% endif %}
	</p>
	<hr>
{% endif %}

{% if clin_template.accept_comments %}
	<p>{% trans "You can see any comments by clicking on the '<strong>show comments</strong>' beside each item, or click '<strong>add comment</strong>' to have your say." %}</p>
{% else %}
	<p>{% trans 'This template does not accept comments.' %}</p>
{% endif %}

<div id="ct-tabs">
	<ul>
		<li><a href="{% url template-detail clin_template.id %}?tView=0"><span>{% trans "View as form"%}</span></a></li>
		<li><a href="{% url template-detail clin_template.id %}?tView=1"><span>{% trans "View as data"%}</span></a></li>
		{% if clin_template.documentation %}
			<li><a href="{% url template-detail clin_template.id %}?tView=2"><span>{% trans 'Documentation' %}</span></a></li>
		{% endif %}
		<li><a href="{% url template-detail clin_template.id %}?tView=3"><span>{% trans "Metadata"%}</span></a></li>
	</ul>
</div>

<div id="ct-tabs-alt">
  <ul class="subnav">
	{% if clin_template.accept_comments %}
	<li><a href="" class="toggleallcomments">{% trans "Show all comments"%}</a></li>
	{% endif %}
	<li><a href="/templates/{{ clin_template.id }}/?tView=0">{% trans "See template form"%}</a></li>
	<li><a href="/templates/{{ clin_template.id }}/?tView=1">{% trans "See template data"%}</a></li>
	<li><a href="/templates/{{ clin_template.id }}/?tView=2">{% trans "Documentation"%}</a></li>
	<li><a href="/templates/{{ clin_template.id }}/?tView=3">{% trans "Metadata"%}</a></li>
  </ul>

{% block template_detail %}{% endblock template_detail %}

</div>

{% if clin_template.workgroup|resource_delete:user %}
    <p><a href="{% url template-delete clin_template.id %}">{% trans 'Delete' %}</a></p>
{% endif %}

{% endblock %}
